!function(a){a.fn.tagInput=function(b){for(var c={tagKeys:["space","comma","enter"],emailSeperator:",",defaultText:null,defaultEmails:null,validEmailTest:null,allowMultipleEntry:!0,multipleEntrySeperator:";",nameAndEmailFormat:!0,showEmailonFocusLost:!1},d=a.extend({},c,b),e=0;e<d.tagKeys.length;e++)"space"==d.tagKeys[e]?d.tagKeys[e]=32:"comma"==d.tagKeys[e]?d.tagKeys[e]=188:"enter"==d.tagKeys[e]?d.tagKeys[e]=13:"semicolon"==d.tagKeys[e]?d.tagKeys[e]=59:d.tagKeys[e]===parseInt(d.tagKeys[e],10)&&(d.tagKeys[e]=d.tagKeys[e]);return d.emailSeperator=d.emailSeperator.trim(),console.log(d),this.each(function(){function b(b){if(b=b.trim(),d.nameAndEmailFormat&&b.indexOf("<")!=-1&&b.indexOf(">")!=-1&&b.indexOf(d.multipleEntrySeperator.trim())!=-1){b=b.split(d.multipleEntrySeperator.trim());for(var e=0;e<b.length;e++)b[e]=b[e].substring(b[e].indexOf("<")+1,b[e].indexOf(">")),b[e]=b[e].trim();for(var e=0;e<b.length;e++)if(b[e].trim()&&"invalid"==g(b[e].trim()))return a(n).addClass("tagInput-invalid-email"),!1;for(var e=0;e<b.length;e++)b[e].trim()&&c(b[e].trim());return!0}if(d.nameAndEmailFormat&&b.indexOf("<")!=-1&&b.indexOf(">")!=-1)return b=b.substring(b.indexOf("<")+1,b.indexOf(">")),b.trim()&&"invalid"==g(b.trim())?(a(n).addClass("tagInput-invalid-email"),!1):(c(b[e].trim()),!0);if(d.allowMultipleEntry&&b.indexOf(d.multipleEntrySeperator.trim())!=-1){b=b.split(d.multipleEntrySeperator.trim());for(var e=0;e<b.length;e++)if(b[e].trim()&&"invalid"==g(b[e].trim()))return a(n).addClass("tagInput-invalid-email"),!1;for(var e=0;e<b.length;e++)b[e].trim()&&c(b[e].trim());return!0}return"invalid"==g(b)?(a(n).addClass("tagInput-invalid-email"),!1):(c(b.trim()),!0)}function c(b){if("found"!=i(b)){var c=a("<a>").addClass("tagInput-tag-remove").attr("title","Remove").append(a("<span>").addClass("glyphicon glyphicon-remove")),e=a("<div>").addClass("tagInput-tag").append(a("<span>").text(b)).append(c);k.push(b),a(j).val(k.join(d.emailSeperator+" ")),a(m).before(e),f()}}function e(){for(var b=0;b<k.length;b++){value=k[b];var c=a("<a>").addClass("tagInput-tag-remove").attr("title","Remove").append(a("<span>").addClass("glyphicon glyphicon-remove")),d=a("<div>").addClass("tagInput-tag").append(a("<span>").text(value)).append(c);a(m).before(d),f()}}function f(){if(a(m).parent().find(".tagInput-tag:last").length>0){var b=a(l).offset().left+a(l).width(),c=a(m).parent().find(".tagInput-tag:last").offset().left+a(m).parent().find(".tagInput-tag:last").width(),d=b-c-30;d<200?(a(m).width(),a(m).addClass("fullWidth")):(a(m).removeClass("fullWidth"),a(m).width(b-c-50))}else a(m).width(),a(m).addClass("fullWidth")}function g(a){return null!=d.validEmailTest?d.validEmailTest(a):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a)?"valid":"invalid"}function h(){if(""!=a(j).val()){var b=a(j).val();b=b.split(d.emailSeperator);for(var e=0;e<b.length;e++)c(b[e].trim())}if(null!=d.defaultEmails)for(var e=0;e<d.defaultEmails.length;e++)c(d.defaultEmails[e].trim());f()}function i(a){return k.indexOf(a)>=0?"found":"not_found"}var j=this,k=[],l=(a(j).height(),a("<div>").addClass("tagInput-container")),m=a("<div>").addClass("tagInput-input-container"),n=a("<input>").addClass("tagInput-input");d.defaultText&&n.attr("placeholder",d.defaultText);var o=a("<input>").attr("type","hidden").addClass("hidden_text");a(m).append(n),a(l).append(m),a(l).append(o),a(j).after(l),a(n).on("keydown",function(c){a(this).removeClass("tagInput-invalid-email");var e;if(window.event?e=c.keyCode:c.which&&(e=c.which),d.tagKeys.indexOf(e)!=-1){var g=0;1==b(a(this).val())&&(a(this).val(""),g=1,a(this).on("keyup",function(b){1==g&&(a(this).val(""),g=0)}))}else 8==e&&0==a(this).val().length&&a(m).parent().find(".tagInput-tag:last").length>0&&(k.splice(k.indexOf(a(l).find(".tagInput-tag:last").text()),1),a(j).val(k.join(d.emailSeperator+" ")),a(l).find(".tagInput-tag:last").remove(),f())}),function(){a(l).on("click",".tagInput-tag-remove",function(b){b.preventDefault(),a(this).parent().remove(),k.splice(k.indexOf(a(this).parent().find("span").text()),1),a(j).val(k.join(d.emailSeperator+" "))})}(),h(),d.showEmailonFocusLost&&(a(l).find(".tagInput-tag").remove(),a(l).find("input").val(k.join("; ")),a(n).focus(function(){e(),a(this).val("")}).blur(function(){a(l).find(".tagInput-tag").remove(),a(l).find("input").val(k.join("; "))}));var p=!1,q=!1,r=!1;return a(document).on("keydown",function(b){var c;window.event?c=b.keyCode:b.which&&(c=b.which),17==c?p&&(a(o).select(),r=!0):r?r=!1:(currentCopyEvent=!1,a(l).find(".copy-state").removeClass("copy-state"),a(o).val(""))}),function(){a(l).on("click",".tagInput-tag",function(b){p=!0,q=!0,a(l).find(".copy-state").removeClass("copy-state"),a(this).addClass("copy-state"),a(o).val(a(this).find("span").text())})}(),a(document).on("click",function(b){p&&!q&&(p=!1,a(l).find(".copy-state").removeClass("copy-state"),a(o).val("")),q=!1}),a(this).hide()})}}(jQuery);